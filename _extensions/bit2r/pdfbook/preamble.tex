%%==============================================================================
%% Set page size with a wider right margin
%%==============================================================================
\usepackage{geometry}
\geometry{%
  a4paper,
  top=25mm,
  headsep=10mm,
  bottom=20mm,
  footskip=15mm,
  right=1.2in,
  left=1.2in,
  layoutsize={188mm,240mm},
  layoutoffset={.5in,.5in},
  % showframe,
  showcrop
}

%%==============================================================================
%% load packages
%%==============================================================================
\usepackage{diagbox}                        % 테이블 셀에 대각선 표시를 위해
\usepackage[utf8]{inputenc}
\usepackage{setspace}
\usepackage{tocloft}
\usepackage{makeidx}
\usepackage{parskip}
\usepackage[hangul]{kotex}
\usepackage[T1]{fontenc} 
\usepackage{listings}                       % shell script code출력을 위함

\usepackage[framemethod=tikz]{mdframed}
\usepackage[unicode]{hyperref}
\usepackage[many]{tcolorbox}
\usepackage{makecell}
\usepackage{environ}
\usepackage[tikz]{bclogo}
\usepackage{tikz}
\usepackage{natbib}
\usepackage{lastpage}
\usepackage{graphicx}
\usepackage{awesomebox}                     % for 시나리오박스


%%==============================================================================
%% 폰트 정의
%%==============================================================================
% kotex의 기본 폰트인 나눔명조의 이탤릭체 등을 표현하기 위해서 (xelatex 엔진)
\setmainfont{Times New Roman}
\setmainhangulfont{NanumMyeongjo}[%
	Renderer = OpenType,
	FontFace = {m}{n}{ Font = * },
	FontFace = {m}{it}{ Font = *, FakeSlant=.167 },
	FontFace = {m}{up}{ Font = * },
	FontFace = {bx}{n}{ Font = {* ExtraBold} },
	FontFace = {bx}{it}{ Font = {* ExtraBold}, FakeSlant=.167 }
]
\setsanshangulfont{SUIT}[%
	Renderer = OpenType,
	FontFace = {m}{n}{ Font = * },
	FontFace = {m}{it}{ Font = *, FakeSlant=.167 },
	FontFace = {m}{up}{ Font = * },
	FontFace = {bx}{n}{ Font = {* ExtraBold} },
	FontFace = {bx}{it}{ Font = {* ExtraBold}, FakeSlant=.167 }
]
\setmainhanjafont{SUIT}
%verbatim에 사용할 mono space 폰트
\setmonofont{NanumGothicCoding}[%
  Scale = 0.9,
  Renderer = OpenType,
	FontFace = {m}{n}{ Font = * },
	FontFace = {m}{it}{ Font = *, FakeSlant=.167 },
	FontFace = {m}{up}{ Font = * },
	FontFace = {bx}{n}{ Font = {* Bold} },
	FontFace = {bx}{it}{ Font = {* Bold}, FakeSlant=.167 }
]
% \setmonofont{D2Coding}
\setmonohangulfont{NanumGothicCoding}[%
  Scale = 0.9,
  Renderer = OpenType,
	FontFace = {m}{n}{ Font = * },
	FontFace = {m}{it}{ Font = *, FakeSlant=.167 },
	FontFace = {m}{up}{ Font = * },
	FontFace = {bx}{n}{ Font = {* Bold} },
	FontFace = {bx}{it}{ Font = {* Bold}, FakeSlant=.167 }
]
% \setmonohangulfont{D2Coding}[Scale=0.9]

%%==============================================================================
%% 절(section)과 서브절(subsection) 타이틀을 돋움체(sans-serif)로 바꾸기
%%==============================================================================
%% Rmarkdown과 titlesec 패키지가 호환되지 않는 이슈가 있음. 
%% 아래 두줄의 명령을 입력하지 않으면 에러가 발생함
%% 문제의 원인:
%% https://stackoverflow.com/questions/40439701/cant-knit-to-pdf-with-custom-styles
%% 문제의 해결
%% https://github.com/rstudio/bookdown/issues/677
\let\paragraph\oldparagraph
\let\subparagraph\oldsubparagraph

\usepackage{titlesec}
\titleformat{\section}
  {\sffamily\selectfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}
  {\sffamily\selectfont\large\bfseries}{\thesubsection}{1em}{}  
  

%%==============================================================================
%% 머리글, 바탕글을 위한 정의
%%==============================================================================
\usepackage{fancyhdr}
\pagestyle{fancy}

%% 폰트 사이즈 정의 
\newcommand{\changesize}{%
  \fontsize{8}{10}\selectfont
}

%% 머리글 바닥글의 위한 폰트 스타일 정의
% 장/절 번호 파트: 볼드 돋움체
\newcommand{\numberfont}{%
  \hangulfontspec{SUIT}\bfseries\selectfont
}
% 장/절 라벨 파트: 돋움체
\newcommand{\labelfont}{%
  \hangulfontspec{SUIT}\selectfont
}
%% 페이지 번호 파트 
\newcommand*\pagefont{\normalfont\bfseries\sffamily}


%% Rule 라인 제거
\renewcommand {\headrulewidth}{0pt} % 라인 제거
\renewcommand {\footrulewidth}{0pt} % 라인 제거

\makeatletter
\DeclareRobustCommand{\format@sec@number}[2]{{\numberfont\upshape#1}#2}
\renewcommand{\chaptermark}[1]{%
  \markboth{\format@sec@number{\ifnum\c@secnumdepth>\m@ne\@chapapp\ \thechapter. \fi}{\labelfont #1}}{}}
\renewcommand{\sectionmark}[1]{%
  \markright{{\numberfont \thesection.} {\labelfont #1}}{}}
\makeatother

\fancyhf{}
\fancyhead[EL]{\changesize \numberfont --- R을 이용한}
\fancyhead[OR]{\changesize \numberfont 통계학 이해 ---}
\fancyfoot[EL]{{\pagefont\thepage}{\hskip4mm}{\changesize \leftmark}}
\fancyfoot[OR]{{\changesize \rightmark}{\hskip4mm}{\pagefont\thepage}}


%%==============================================================================
%% 컬러 정의
%%==============================================================================
\definecolor{gray95}{gray}{.95}
\definecolor{gray85}{gray}{.85}
\definecolor{aliceblue}{rgb}{0.94, 0.97, 1.0}
\definecolor{ExerciseColor}{gray}{0.65}         % for Exercise 
\definecolor{problemblue}{RGB}{100, 134, 158}   % for 시각화전략
\definecolor{light}{HTML}{E6E6FA}
\definecolor{highlight}{HTML}{800080}
\definecolor{dark}{HTML}{330033}


%%==============================================================================
%% hypersetup
%%==============================================================================
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

%%==============================================================================
%% Define code blocks - for single space
%%==============================================================================
%% https://stackoverflow.com/questions/73439371/quarto-pdf-output-code-block-line-spacing
\renewenvironment{Shaded}
    {\begin{snugshade}
    \begin{singlespace}
    \linespread{1}
    }
    {\end{singlespace}
    \end{snugshade}
}


%%==============================================================================
%% 객체 정의
%%==============================================================================
\lstset{
  extendedchars=false,
  basicstyle=\small\ttfamily,
  backgroundcolor=\color{gray85}
}


\surroundwithmdframed[linewidth=0pt,innerleftmargin=5pt,backgroundcolor=gray95,font=\small]{verbatim}


\usetikzlibrary{calc}

\tcbuselibrary{many}

%%==============================================================================
%% shadequote 정의: 강조하는 문장을 표현하기 위해서 
%%==============================================================================
%% https://tex.stackexchange.com/questions/16964/block-quote-with-big-quotation-marks
%% Start shadequote define ----------------------------------------------------- 
\newcommand*\quotefont{\fontfamily{NanumMyeongjo}} % selects NanumMyeongjo as the quote font
\newcommand*\quotesize{45} % if quote size changes, need a way to make shifts relative

% Make commands for the quotes
\newcommand*{\openquote}
   {\tikz[remember picture,overlay,xshift=-4ex,yshift=-2.5ex]
   \node (OQ) {\quotefont\fontsize{\quotesize}{\quotesize}\selectfont``};\kern0pt}

\newcommand*{\closequote}[1]
  {\tikz[remember picture,overlay,xshift=4ex,yshift={#1}]
   \node (CQ) {\quotefont\fontsize{\quotesize}{\quotesize}\selectfont''};}

% select a colour for the shading
\colorlet{shadecolor}{gray85}

\newcommand*\shadedauthorformat{\emph} % define format for the author argument

% Now a command to allow left, right and centre alignment of the author
\newcommand*\authoralign[1]{%
  \if#1l
    \def\authorfill{}\def\quotefill{\hfill}
  \else
    \if#1r
      \def\authorfill{\hfill}\def\quotefill{}
    \else
      \if#1c
        \gdef\authorfill{\hfill}\def\quotefill{\hfill}
      \else\typeout{Invalid option}
      \fi
    \fi
  \fi}
% wrap everything in its own environment which takes one argument (author) and one optional argument
% specifying the alignment [l, r or c]
%
\newenvironment{shadequote}[2][l]%
{\authoralign{#1}
\ifblank{#2}
   {\def\shadequoteauthor{}\def\yshift{-2ex}\def\quotefill{\hfill}}
   {\def\shadequoteauthor{\par\authorfill\shadedauthorformat{#2}}\def\yshift{2ex}}
\begin{snugshade}\begin{quote}\openquote}
{\shadequoteauthor\quotefill\closequote{\yshift}\end{quote}\end{snugshade}}

%% End shadequote define ------------------------------------------------------- 


%%==============================================================================
%% 예제 프레임 정의
%%==============================================================================
%%------------------------------------------------------------------------------
%% 예제 environment - 예제 프레임 정의
%%------------------------------------------------------------------------------
\newenvironment{example}[1]{%
  \mdfsetup{
    skipabove=20pt,
    skipbelow=10pt,
    innertopmargin=0pt,
    innerbottommargin=4pt,
    leftmargin=-13pt,
    splitbottomskip=0ex,
    splittopskip=0ex,
    topline=false,
    leftline=true,
    bottomline=false,
    rightline=false,
    innerrightmargin=0pt,
    innerlinewidth=2pt,
    font=\normalfont,
    frametitle={\textbf{예제 #1.}}, 
    linecolor=ExerciseColor,
  }
\begin{mdframed}%
}
{\end{mdframed}}

%%------------------------------------------------------------------------------
%% Custom refference for 예제 environment
%%------------------------------------------------------------------------------
%% https://tex.stackexchange.com/questions/18191/defining-custom-labels
\makeatletter
\newcommand{\examplelabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}} }%
   \hypertarget{#1}{}
}   
\makeatother


%%==============================================================================
%% 시나리오 박스 : snbox
%%==============================================================================
\newcommand{\snbox}[4]{
    \begin{figure}[h]
        \centering
    \begin{tikzpicture}
        \node[anchor=text,text width=\columnwidth-1.2cm, draw, rounded corners, line width=1pt, fill=#3, inner sep=5mm] (big) {\\#4};
        \node[draw, rounded corners, line width=.5pt, fill=#2, anchor=west, xshift=5mm] (small) at (big.north west) {#1};
    \end{tikzpicture}
    \end{figure}
}


%%==============================================================================
%% 아이디어 박스 정의 
%%==============================================================================
\NewEnviron{idea}[1]
  {\par\medskip\noindent
  \begin{tikzpicture}
    \node[inner sep=0pt] (box) {\parbox[t]{.99\textwidth}{%
      \begin{minipage}[t]{.12\textwidth}
        \centering
        \tikz[scale=5]\node[scale=1.3,rotate=-10]{\bcinfo};
      \end{minipage}%
      \begin{minipage}{.83\textwidth}
      \textbf{#1}\par\smallskip
      \BODY
      \end{minipage}\hfill}%
    };
    \draw[gray!75!black,line width=3pt] 
      ( $ (box.north east) + (-5pt,3pt) $ ) -- ( $ (box.north east) + (0,3pt) $ ) -- ( $ (box.south east) + (0,-3pt) $ ) -- + (-5pt,0);
    \draw[gray!75!black,line width=3pt] 
      ( $ (box.north west) + (5pt,3pt) $ ) -- ( $ (box.north west) + (0,3pt) $ ) -- ( $ (box.south west) + (0,-3pt) $ ) -- + (5pt,0);
  \end{tikzpicture}\par\medskip%
}

%%------------------------------------------------------------------------------
%------ 차례 작성 
%%------------------------------------------------------------------------------
\makeindex

